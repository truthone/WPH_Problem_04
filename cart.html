<html>
  <head>
    <title>AMAZING MARKET</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./global.css" />
    <link rel="stylesheet" href="./index.css" />
    <style>
      #cart-table {
        width: 100%;
        border-collapse: collapse;
        word-break: keep-all;
        margin: 20px 0;
        min-width: 400px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
        background-color: rgb(240, 240, 240);
        text-align: center;
      }

      #cart-table th {
        background-color: rgb(60, 72, 107);
        color: rgb(255, 255, 255);
      }
    </style>
  </head>

  <body>
    <header class="sticky">
      <div id="logo">ğŸ’–ì–´ë©”ì´ì§•ë§ˆì¼“ğŸ’–</div>
      <nav id="menu">
        <button class="icon icon-nav material-symbols-rounded">person</button>
      </nav>
    </header>
    <main>
      <section id="cart">
        <div id="cart-table">
          <div class="flex-between">
            <div>ì´ë¯¸ì§€</div>
            <div>ìƒí’ˆëª…</div>
            <div>ê°€ê²©</div>
            <div>ìˆ˜ëŸ‰</div>
            <div>ì´ ê°€ê²©</div>
          </div>
          <section id="cart-items"></section>
        </div>
      </section>
      <section id="summary">
        <span id="amount">ì´ ìˆ˜ëŸ‰: </span><span>ê°œ</span>
        <span>/</span>
        <span id="sum">ì´ í•©ê³„: </span><span>ì›</span>
      </section>
    </main>
    <footer>
      AMAZING MARKET â“’ 2023
      <br />
      ëŒ€í‘œë²ˆí˜¸ 02-0000-0000 ëŒ€í‘œì´ë©”ì¼ ulift@ulift.kr
      <br />
      All Photos by Unsplash
      <script src="./header.js"></script>
    </footer>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        cart = loadCart();
        renderCartItems();
      });

      document.addEventListener("click", (e) => {
        if (e.target && e.target.classList.contains("remove-button")) {
          const productId = e.target.dataset.id;
          if (productId) {
            removeFromCart(productId);
          }
        }
      });

      function loadCart() {
        const storedCart = sessionStorage.getItem("cart");
        return storedCart ? JSON.parse(storedCart) : [];
      }

      function renderCartItems() {
        const cartItemsElement = document.getElementById("cart-items");
        cartItemsElement.innerHTML = "";
        let sum = 0;
        let amount = 0;

        console.log(cart);

        cart.forEach((item) => {
          const row = document.createElement("tr");
          row.innerHTML = `
              <div><img src="${item.imageUrl}" alt="${item.productName}""></div>
              <div>${item.productName}</div>
              <div>${item.price}ì›</div>
              <div>${item.quantity}</div>
              <div>${item.price * item.quantity}ì›</div>
              <div>
                <button class='remove-button' data-id="${item.productId}">
                  ì‚­ì œ
                </button>
              </div>
            `;
          sum += item.price;
          amount += item.quantity;
          cartItemsElement.appendChild(row);
        });

        renderSum(sum, amount);
      }

      function removeFromCart(productId) {
        const productIndex = cart.findIndex(
          (item) => item.productId === productId
        );

        if (productIndex !== -1) {
          cart.splice(productIndex, 1);
        }
        saveCart();
        renderCartItems();
      }

      function saveCart() {
        localStorage.setItem("cart", JSON.stringify(cart));
      }

      function renderSum(amount) {
        const totalSum = cart.reduce(
          (acc, item) => acc + item.price * item.quantity,
          0
        );
        document.getElementById("amount").innerHTML = `ì´ ìˆ˜ëŸ‰: ${amount}`;
        document.getElementById("sum").innerHTML = `ì´ í•©ê³„: ${totalSum}`;
      }
    </script>
  </body>
</html>
